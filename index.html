<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { text-align:center; font-family:sans-serif; background:#f0f0f0; }
  #gacha { margin-top:30px; }
  #gacha img { width:150px; transition: transform 0.5s; }
  #prize { display:none; position:relative; margin-top:20px; }
  #prize img { width:200px; }
  #prize .close { position:absolute; top:5px; right:5px; cursor:pointer; font-size:20px; }
  #status { margin-top:10px; font-weight:bold; }
  button { padding:10px 20px; margin-top:10px; font-size:16px; cursor:pointer; }
  input { padding:10px; font-size:16px; width:120px; text-align:center; }
</style>
</head>
<body>

<h1>線上扭蛋抽獎</h1>

<!-- 驗證碼輸入頁 -->
<div id="verify">
  <input type="text" id="codeInput" placeholder="輸入4位驗證碼"/>
  <button onclick="verifyCode()">確認</button>
</div>

<!-- 抽獎頁 -->
<div id="gacha" style="display:none;">
  <div id="status">已抽：0 / 剩餘：60</div>
  <img id="gachaEgg" src="gacha.png" alt="扭蛋">
  <br>
  <button onclick="drawPrize()">抽獎</button>
</div>

<!-- 獎項頁 -->
<div id="prize">
  <div class="close" onclick="backToGacha()">✖</div>
  <h2>恭喜抽到：</h2>
  <img id="prizeImg" src="" alt="獎項">
  <h3 id="prizeName"></h3>
</div>

<script>
let currentCode = '';
let prizeImages = {
  A: 'A.png', // 替換成真實圖片路徑
  B: 'B.png',
  C: 'C.png',
  D: 'D.png'
};

// 更新剩餘抽數
function updateStatus(){
  fetch('https://nny-08.github.io:3000/status')
  .then(res=>res.json())
  .then(data=>{
    document.getElementById('status').innerText = `已抽：${data.drawn} / 剩餘：${data.remaining}`;
  });
}

// 驗證碼確認
function verifyCode(){
  const code = document.getElementById('codeInput').value;
  if(code.length !== 4){ alert('請輸入4位驗證碼'); return; }
  fetch('https://nny-08.github.io:3000/check-code', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body: JSON.stringify({code})
  })
  .then(res=>res.json())
  .then(data=>{
    if(data.success){
      currentCode = code;
      document.getElementById('verify').style.display='none';
      document.getElementById('gacha').style.display='block';
      updateStatus();
    }else{
      alert(data.message);
    }
  });
}

// 扭蛋動畫 + 抽獎
function drawPrize(){
  const egg = document.getElementById('gachaEgg');
  egg.style.transform = 'rotate(360deg)'; // 旋轉動畫
  setTimeout(()=>{
    fetch('https://nny-08.github.io:3000/draw',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({code: currentCode})
    })
    .then(res=>res.json())
    .then(data=>{
      if(data.success){
        document.getElementById('gacha').style.display='none';
        document.getElementById('prizeImg').src = prizeImages[data.prize];
        document.getElementById('prizeName').innerText = data.prize;
        document.getElementById('prize').style.display='block';
        updateStatus();
        egg.style.transform = 'rotate(0deg)'; // 重置動畫
      }else{
        alert(data.message);
      }
    });
  },600); // 動畫時間
}

// 返回抽獎頁
function backToGacha(){
  document.getElementById('prize').style.display='none';
  document.getElementById('gacha').style.display='block';
}

</script>

</body>
</html>





